{"version":3,"sources":["ts/libs/unobservable.js"],"names":["unobservable","CustomArray","numPreallocated","arr","Array","len","prototype","push","e","removeAt","index","j","observable","obj","options","numPreallocatedHandlers","addDataMembers","callbacks","on","events","fn","count","i","length","name","i2","indexOf","slice","typed","off","fns","cb","undefined","one","trigger","arg1","arg2","arg3","arg4","call","Observable","asObservable","window","exports","self"],"mappings":"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","file":"unobservable.4b6dbb5e.js","sourceRoot":"..","sourcesContent":["(function(unobservable) { \"use strict\";\n\n// Black magic stuff\nfunction CustomArray(numPreallocated) {\n    this.arr = new Array(numPreallocated);\n    this.len = 0;\n}\nCustomArray.prototype.push = function(e) {\n    this.arr[this.len++] = e;\n};\nCustomArray.prototype.removeAt = function(index) {\n    for(var j=index+1; j<this.len; j++) {\n        this.arr[j-1] = this.arr[j];\n    }\n    // Potential memory leak right here, last element does not get nulled out as it should? Or?\n    this.len--;\n}\n\nunobservable.observable = function(obj, options) {\n    options = options || {};\n    options.numPreallocatedHandlers = options.numPreallocatedHandlers || 0;\n    options.addDataMembers = (typeof options.addDataMembers !== \"undefined\") ? options.addDataMembers : true;\n    if(options.addDataMembers) {\n        obj.callbacks = {};\n    }\n\n    obj.on = function(events, fn) {\n        // This function is convoluted because we would like to avoid using split or regex, both which cause an array allocation\n        var count = 0;\n        for(var i=0, len=events.length; i<len; ++i) {\n            var name = \"\";\n            var i2 = events.indexOf(\" \", i);\n            if(i2 < 0) {\n                if(i < events.length) {\n                    name = events.slice(i);\n                    count++;\n                }\n                i = len;\n            }\n            else if(i2-i > 1) {\n                var name = events.slice(i, i2);\n                count++;\n                i = i2;\n            }\n            if(name.length > 0) {\n                (this.callbacks[name] = this.callbacks[name] || new CustomArray()).push(fn);\n            }\n        }\n        fn.typed = count > 1;\n    };\n\n    obj.off = function(events, fn) {\n        if (events === \"*\") this.callbacks = {};\n        else if (fn) {\n            var fns = this.callbacks[events];\n            for (var i = 0, len=fns.len; i<len; ++i) {\n                var cb = fns.arr[i];\n                if(cb === fn) { fns.removeAt(i); }\n            }\n        } else {\n            var count = 0;\n            for(var i=0, len=events.length; i<len; ++i) {\n                var name = \"\";\n                var i2 = events.indexOf(\" \", i);\n                if(i2 < 0) {\n                    if(i < events.length) {\n                        name = events.slice(i);\n                    }\n                    i = len;\n                }\n                else if(i2-i > 1) {\n                    var name = events.slice(i, i2);\n                    i = i2;\n                }\n                if(name.length > 0) {\n                    this.callbacks[name] = undefined;\n                }\n            }\n        }\n        return this;\n    };\n\n    // Only single event supported\n    obj.one = function(name, fn) {\n        fn.one = true;\n        return this.on(name, fn);\n    };\n\n    obj.trigger = function(name, arg1, arg2, arg3, arg4) {\n        // Just using bogus args is much faster than manipulating the arguments array\n        var fns = this.callbacks[name];\n        if(!fns) { return this; }\n\n        for (var i=0; i<fns.len; i++) { // Note: len can change during iteration\n            var fn = fns.arr[i];\n            if(fn.typed) { fn.call(this, name, arg1, arg2, arg3, arg4); }\n            else { fn.call(this, arg1, arg2, arg3, arg4); }\n            if (fn.one) { fns.removeAt(i, 1); fn.one = false; i--; }\n            else if(fns.arr[i] && fns.arr[i] !== fn) { i-- } // Makes self-removal possible during iteration\n        }\n        return this;\n    };\n    return obj;\n};\n\nunobservable.Observable = function() {\n    this.callbacks = {};\n};\nunobservable.observable(unobservable.Observable.prototype, {numPreallocatedHandlers: 2, addDataMembers: false});\nunobservable.asObservable = unobservable.observable;\nunobservable.CustomArray = CustomArray; // Expose for testability\n})((typeof window !== \"undefined\" ? window.unobservable = {} : (typeof exports !== \"undefined\" ? exports : self.unobservable = {})));"]}